<html>
	<head>
	<script>

//------------------------------------=======############==========----------------------------------------
//                                 Canvas Slide Constants and Variables
//------------------------------------=======############==========----------------------------------------
		
// Challenge: Make animated threes-game with smallest amount of code

var c;
var arrpnt=[];
var delay=30;		

var xmax=1430;
var ymax=780;

var mx,my,mb;

var grd1;
		
function drawCirc(x,y,r,fill)
{
	c.beginPath();
	c.arc(x, y, r, 0, 2 * 3.1415, false);
	if(fill==true){
			c.fill();	
	}else{
			c.stroke();	
	}

}
	
function setupSlides()
{
		canvas = document.getElementById("mycanvas");
		c = canvas.getContext("2d");

		setTimeout(drawHead,delay);
}

// Draw a symbol with rounded corners
		
function drawSymbol(xk,yk,w,h,val)
{
		var r=8;
		c.beginPath();
		c.moveTo(xk+r,yk);
		c.lineTo(xk+w-r,yk);
		c.quadraticCurveTo(xk+w,yk,xk+w,yk+r);
		c.lineTo(xk+w,yk+h-r);
		c.quadraticCurveTo(xk+w,yk+h,xk+w-r,yk+h);
		c.lineTo(xk+r,yk+h);
		c.quadraticCurveTo(xk,yk+h,xk,yk+h-r);
		c.lineTo(xk,yk+r);
		c.quadraticCurveTo(xk,yk,xk+r,yk);
	
		if(val==0){
				c.stroke();		
		}else{
				c.textAlign = "center"; 
				c.textBaseline = "middle"; 
				c.font="30px Comic Sans MS";	
				if(val==1){
						c.fillStyle="#f28";
				}else{
						c.fillStyle="#28f";
				}
				c.fill();
			
				c.fillStyle="#000";

				c.fillText(val,xk+(w*0.5),yk+(h*0.5));		
		}
}
		
// Shift function does not know which tiles we are shifting
function shift(topos,frompos,fromx,fromy,tox,toy)
{
		if((gamegrid[topos]==0)&&(gamegrid[frompos]!=0)){
				// Empty -> Something
				anim.push({fx:fromx,fy:fromy,tx:tox,ty:toy,ns:gamegrid[frompos],ne:gamegrid[frompos]})
				gamegrid[topos]=gamegrid[frompos];
				gamegrid[frompos]=0;
		}else if(((gamegrid[topos]==1)&&(gamegrid[frompos]==2))||((gamegrid[topos]==2)&&(gamegrid[frompos]==1))){
				// 1 -> 2 || 2 -> 1 (push one static and one moving animation to three)
				gamegrid[topos]=3;
				gamegrid[frompos]=0;
		}else if((gamegrid[topos]==gamegrid[frompos])&&(gamegrid[topos]!=2)&&(gamegrid[topos]!=1)){
				// something -> same something (double)
				gamegrid[topos]=gamegrid[topos]*2;
				gamegrid[frompos]=0;		
		}else if(gamegrid[frompos]!=0){
				// From position not moving but not empty (animate only)
		}
}

// Animate tile positions

function animate(perc)
{
		c.textAlign = "center"; 
		c.textBaseline = "middle"; 
		c.font="30px Comic Sans MS";	
	
		for(var i=0;i<anim.length;i++){
				item=anim[i];
				xk=item.fx+((item.tx-item.fx)*perc);
				yk=item.fy+((item.ty-item.fy)*perc);
				
		}
}

const radius=220;
var offs=0;
		
var gamegrid=[];
var gridX=7;
var gridY=7;
var anim=[];

for(var i=0;i<(gridX*gridY);i++){
		gamegrid[i]=0;
}

gamegrid[8]=96;		
gamegrid[9]=1;
gamegrid[10]=2;
gamegrid[11]=3;
gamegrid[12]=6;		
gamegrid[17]=12;
gamegrid[31]=24;
gamegrid[30]=48;
		
// Update grid (tetris physics)
function progressGrid(mox,moy)
{
		anim=[];
		if(mox==1){
				// Move right! - progress from top to bottom, and from right to left
				for(var j=1;j<(gridY-1);j++){
						for(var i=(gridX-2);i>=1;i--){
								shift((j*gridX)+i,(j*gridX)+i-1,i,j,i+1,j);
						}
				}
		}else if(mox==-1){
				// Move left! - progress from top to bottom, and from left to right
				for(var j=1;j<(gridY-1);j++){
						for(var i=1;i<=(gridX-1);i++){
								shift((j*gridX)+i,(j*gridX)+i+1,i,j,i-1,j);
						}
				}			
		}else if(moy==1){
				// Move down
				for(var j=(gridY-2);j>=1;j--){
						for(var i=(gridX-2);i>=1;i--){
								shift((j*gridX)+i,(j*gridX)+i-gridY,i,j,i,j+1);
						}
				}
		}else if(moy==-1){
				// Move up
				for(var j=1;j<(gridY-1);j++){
						for(var i=1;i<=(gridX-1);i++){
								shift((j*gridX)+i,(j*gridX)+i+gridY,i,j,i,j-1);
						}
				}
		}
}
				
//----------------------------------------------------------------------------------
// drawHead - Clear screen and keep drawing
//----------------------------------------------------------------------------------

progressGrid(1,0);
var perc=0;
function drawHead()
{
		c.globalAlpha=1.0;
		c.clearRect(0,0,xmax,ymax);
	
		c.fillStyle = "RGB(0,59,85)";	
		c.strokeStyle="#bbb";

		var mox=1;
		var moy=0;

		// Draw game grid
		animate(perc);
	
		perc+=0.01;
		if(perc>1.0) perc=0.0;
	
}
		
function mousemove(e)
{
		var rect = e.target.getBoundingClientRect();
		mx = e.clientX - rect.left; //x position within the element.
		my = e.clientY - rect.top;  //y position within the element.				
}

	</script>
	</head>
	<body onload="setupSlides();">
	<canvas id='mycanvas' width=1430 height=780 style='border:1px solid red;' onmousemove='mousemove(event);' ></canvas>	
	</body>

</html>