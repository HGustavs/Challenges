<html>
<head>
    <script src="helperFunction/icons.js"></script>
		<script>
				var ctx;
			  var mx,my,mb=0;
        var cmx,cmy;
        var smx,smy;

        const pixw=50;
        const marg=40;
        const cageoffs=5;

        var currentguess=[1,6,8,3];
			
        // https://www.youtube.com/watch?v=wO1G7GkIrWE
        // Sudoku App

        // Pastel Colors
        var pastels=["#eee","#eee","#fed","#def","#dfe","#ffd","#dff","#fdf","#dfc","#fcd"];

        // Grid
        numbers=[[],[],[],[],[],[],[],[],[]];

        // Initial values
        init=[
          {x:3,y:6,val:2}
        ]
			
        // Cages
        cages=[
            {
                lines:[{x:0,y:0},{x:5,y:0},{x:5,y:1},{x:1,y:1},{x:1,y:4},{x:3,y:4},{x:3,y:7},{x:0,y:7},{x:0,y:7}],
                items:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:0,y:3},{x:1,y:3}]
            },
            {
                lines:[{x:4,y:2},{x:5,y:2},{x:5,y:10},{x:7,y:10},{x:7,y:11},{x:4,y:11},{x:4,y:9},{x:1,y:9},{x:1,y:11},{x:0,y:11},{x:0,y:8},{x:4,y:8}],
                items:[{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:2,y:4},{x:2,y:5},{x:3,y:5},{x:2,y:4},{x:1,y:4},{x:0,y:5}]
            },
            {
                lines:[{x:0,y:12},{x:7,y:12},{x:7,y:13},{x:5,y:13},{x:5,y:17},{x:4,y:17},{x:4,y:13},{x:1,y:13},{x:1,y:17},{x:0,y:17}],
                items:[{x:0,y:6},{x:1,y:6},{x:2,y:6},{x:3,y:6},{x:0,y:7},{x:2,y:7},{x:0,y:8},{x:2,y:8}]
            },
            {
                lines:[{x:6,y:0},{x:11,y:0},{x:11,y:3},{x:10,y:3},{x:10,y:1},{x:7,y:1},{x:7,y:8},{x:9,y:8},{x:9,y:9},{x:6,y:9}],
                items:[{x:3,y:0},{x:3,y:1},{x:3,y:2},{x:3,y:3},{x:3,y:4},{x:4,y:4},{x:4,y:0},{x:5,y:0},{x:5,y:1}]
            },
            {
                lines:[{x:8,y:2},{x:9,y:2},{x:9,y:6},{x:11,y:6},{x:11,y:8},{x:13,y:8},{x:13,y:9},{x:10,y:9},{x:10,y:9},{x:10,y:7},{x:8,y:7}],
                items:[{x:4,y:1},{x:4,y:2},{x:4,y:3},{x:5,y:3},{x:5,y:4},{x:6,y:4}]
            },            
            {
                lines:[{x:6,y:17},{x:6,y:16},{x:8,y:16},{x:8,y:10},{x:9,y:10},{x:9,y:12},{x:12,y:12},{x:12,y:10},{x:13,y:10},{x:13,y:15},{x:12,y:15},{x:12,y:13},{x:9,y:13},{x:9,y:17}],
                items:[{x:3,y:8},{x:4,y:5},{x:4,y:6},{x:4,y:7},{x:4,y:8},{x:5,y:6},{x:6,y:5},{x:6,y:6},{x:6,y:7}]
            },  
            {
                lines:[{x:12,y:0},{x:17,y:0},{x:17,y:3},{x:16,y:3},{x:16,y:1},{x:13,y:1},{x:13,y:7},{x:12,y:7},{x:12,y:6},{x:12,y:5},{x:10,y:5},{x:10,y:4},{x:12,y:4}],
                items:[{x:5,y:2},{x:6,y:0},{x:6,y:1},{x:6,y:2},{x:6,y:3},{x:7,y:0},{x:8,y:0},{x:8,y:1}]
            }, 
            {
                lines:[{x:14,y:2},{x:15,y:2},{x:15,y:4},{x:17,y:4},{x:17,y:11},{x:16,y:11},{x:16,y:5},{x:14,y:5}],
                items:[{x:7,y:1},{x:7,y:2},{x:8,y:2},{x:8,y:3},{x:8,y:4},{x:8,y:5}]
            }, 
            {
                lines:[{x:14,y:8},{x:15,y:8},{x:15,y:12},{x:17,y:12},{x:17,y:17},{x:12,y:17},{x:12,y:16},{x:14,y:16}],
                items:[{x:6,y:8},{x:7,y:4},{x:7,y:5},{x:7,y:6},{x:7,y:7},{x:7,y:8},{x:8,y:6},{x:8,y:7},{x:8,y:8}]
            }
          ]

				function setup()
				{
						var cc = document.getElementById("myCanvas");
				    ctx = cc.getContext("2d");
					
            for(var j=0;j<9;j++){
                  var item=numbers[j];
                  for(var i=0;i<9;i++){
                      var val=0;
                      for(var k=0;k<init.length;k++){
                          if((init[k].x==i)&&(init[k].y==j)) val=init[k].val;
                      }
                      numbers[j][i]={val:val,guess:[],backg:"none"};
                  }
            }

						drawit();
				}
						
        // We check sudoku state 
				function checkState(sudoku,cages,ortho)
				{
            // Clear all errors
            for(var i=0;i<9;i++){
                for(var j=0;j<9;j++){
                    numbers[i][j].err=false;
                }
              }
                
            for(var i=0;i<9;i++){
                  for(var j=0;j<9;j++){
                      // We check if number is above 0
                      var theval=numbers[i][j].val;
                      if(theval>0){
                          // We first go over all on same row / column and check for duplicates
                          for(var k=0;k<9;k++){
                              if((k!=j)&&(numbers[i][k].val==theval)){
                                numbers[i][j].err=true;
                                numbers[i][k].err=true;
                              }
                              if((k!=i)&&(numbers[k][j].val==theval)){
                                numbers[i][j].err=true;
                                numbers[k][j].err=true;
                              }
                          }
                          // We then go over all in same block
                          var ci=Math.floor(i/3)*3;
                          var cj=Math.floor(j/3)*3;
                          for(var k=0;k<3;k++){
                              for(var l=0;l<3;l++){
                                  if((numbers[ci+k][cj+l].val==theval)&&(!((i==(ci+k))&&(j==(cj+l))))){
                                      numbers[i][j].err=true;
                                      numbers[ci+k][cj+l].err=true;
                                  }
                              }
                          }
                          
                      }
                      
                  }
            }

            
            
            // We go over all in same square and check for duplicates
				}
			
				function mouseUp(e)
				{
            mb=0;
            if(cmx>=0&&cmx<9&&cmy>=0&&cmy<9){
                // We only perform this if we are not on an init square this way we can not mark / update init squares
                smx=cmx;
                smy=cmy;
            }else if(cmx>=0&&cmx<9&&cmy<13){
                if(smx>=0&&smx<9&&smy>=0&&smy<9){
                    if(cmy==10){
                        // If number is the same clear, otherwise set
                        if(numbers[smy][smx].val==(cmx+1)){
                            numbers[smy][smx].val=0;
                        }else{
                            numbers[smy][smx].val=(cmx+1);
                        }
                    }else if(cmy==11){
                        // Number was found in list then we clear
                        if(numbers[smy][smx].guess.indexOf(cmx+1)!=-1){
                            numbers[smy][smx].guess.splice(numbers[smy][smx].guess.indexOf(cmx+1),1);
                        }else{
                            numbers[smy][smx].guess.push(cmx+1);
                        }
                    }else if(cmy==12){
                        if(numbers[smy][smx].backg==pastels[cmx]){
                              numbers[smy][smx].backg="none";
                          }else{
                              numbers[smy][smx].backg=pastels[cmx];
                          }
                    }
                }
                checkState(true,true,true);            
            }				
        }
			
				function mouseDown(e)
				{
						mb=e.which;
				}
			
				function mouseMove(e,t)
				{
						var rect = e.target.getBoundingClientRect();
            mx = e.clientX - rect.left; //x position within the element.
            my = e.clientY - rect.top;  //y position within the element
            cmx=Math.floor((mx-marg)/pixw);
            cmy=Math.floor((my-marg)/pixw);
        }

        function findcage(xk,yk)
        {
          for(var i=0;i<cages.length;i++){
                var cage=cages[i];
                for(var j=0;j<cage.items.length;j++){
                    if(cage.items[j].x==xk&&cage.items[j].y==yk) return i;
                }
            }
            return -1;
        }

        const guesscolor="";
        const textcolor="";
        function drawbox(x,y,cage,number,guess,bordercolor,fillcolor,err,sel)
        {
            ctx.lineWidth=2.0;
            if(sel) ctx.lineWidth=4;
            ctx.beginPath();
            ctx.moveTo(x+cage,y+cage);
            ctx.lineTo(x+pixw-cage,y+cage);
            ctx.lineTo(x+pixw-cage,y+pixw-cage);
            ctx.lineTo(x+cage,y+pixw-cage);
            ctx.closePath();

            if(fillcolor!="none"){
                ctx.fillStyle=fillcolor;
                ctx.fill();
            }
            if(bordercolor!="none"){
                ctx.strokeStyle=bordercolor;
                ctx.stroke();
            }

            ctx.strokeStyle="#f44";
            if(err){
                ctx.lineWidth=1.0;
                ctx.beginPath();
                var add=pixw/8;
                for(var i=0;i<pixw;i+=add){
                    ctx.moveTo(x+i,y);
                    ctx.lineTo(x+pixw,y+pixw-i);
                    if(i>0){
                        ctx.moveTo(x,y+pixw-i);
                        ctx.lineTo(x+i,y+pixw);
                    }
                }
                ctx.stroke();
            }

            ctx.font="30px Arial Narrow";
            ctx.fillStyle="#46e";
            if(number>0&&number<=9){
                if(err){
                    ctx.fillStyle="#f44";                      
                }else{
                  ctx.fillStyle="#000";                      
                }
                ctx.fillText(number,x+(pixw*0.5),y+(pixw*0.5));
            }else if(guess.length==1){                   
                ctx.fillText(guess[0],x+(pixw*0.5),y+(pixw*0.5));
            }else if(guess.length==2){
                //  If two guesses draw smaller size than fixed number
                ctx.font="22px Arial Narrow";                          
                ctx.fillText(guess[0],x+(pixw*0.25),y+(pixw*0.5));
                ctx.fillText(guess[1],x+(pixw*0.75),y+(pixw*0.5));
            }else if(guess.length>2){
                ctx.font="16px Arial Narrow";                          
                for(var i=0;i<3;i++){
                    for(var j=0;j<3;j++){
                        theval=(j*3)+i+1;
                        if(guess.indexOf(theval)!=-1){
                            ctx.fillText(theval,x+2+(pixw*(0.15+(i*0.3))),y+4+(pixw*(0.15+(j*0.3))));
                        }
                    }
                }
            }

          }
			
				function drawit()
				{	
						ctx.clearRect(0,0,900,900);

            var currentcage=findcage(cmx,cmy);

            // Draw numbers / Fills
            ctx.textAlign = "center"; 
            ctx.textBaseline = 'middle';
            for(var j=0;j<9;j++){
                  var item=numbers[j];
                  for(var i=0;i<9;i++){
                      var numb=numbers[j][i];
                      if(j==smy&&i==smx){
                          drawbox((i*pixw)+marg,(j*pixw)+marg,4,numb.val,numb.guess,"#fc5",numb.backg,numb.err,true);
                      }else{
                          drawbox((i*pixw)+marg,(j*pixw)+marg,0,numb.val,numb.guess,"none",numb.backg,numb.err,false);
                      }
                  }
            }

            // Draw squares
            ctx.strokeStyle="#000";
            for(var i=0;i<10;i++){
                  if((i%3)==0){
                      ctx.lineWidth=4;
                  }else{
                      ctx.lineWidth=1;
                  }
                  
                  ctx.beginPath();
                  ctx.moveTo(marg,(i*pixw)+marg);
                  ctx.lineTo((pixw*9)+marg,(i*pixw)+marg);
                  ctx.stroke();

                  ctx.beginPath();
                  ctx.moveTo((i*pixw)+marg,marg);
                  ctx.lineTo((i*pixw)+marg,(pixw*9)+marg);
                  ctx.stroke();
            }            

            // Draw cages
            for(var i=0;i<cages.length;i++){
                  var cage=cages[i];
                  var lines=cage.lines;

                  if(i==currentcage){
                    ctx.lineWidth=3;                      
                    ctx.setLineDash([]);
                    ctx.strokeStyle="#f44";
                  }else{
                    ctx.lineWidth=2;                      
                    ctx.setLineDash([5, 5]);
                    ctx.strokeStyle="#888";
                  }

                  ctx.beginPath();
                  for(var j=0;j<lines.length;j++){
                      var item=lines[j];

                      if((item.x%2)==1){
                          var x1=marg+((Math.floor(item.x/2)*pixw)+pixw)-cageoffs;
                      }else{
                          var x1=marg+((Math.floor(item.x/2)*pixw))+cageoffs;
                      }

                      if((item.y%2)==1){
                          var y1=marg+((Math.floor(item.y/2)*pixw)+pixw)-cageoffs;
                      }else{
                          var y1=marg+((Math.floor(item.y/2)*pixw))+cageoffs;
                      }

                      if(j==0){
                        ctx.moveTo(x1,y1);
                      }else{
                        ctx.lineTo(x1,y1);
                      }
                 }
                 ctx.closePath();
                 ctx.stroke();
                 ctx.setLineDash([]); 
            }

            // Draw menu
            var guess=[];
            var numb=-1;
            var col="#000";
            if(smx>0&&smx<10&&smy>0&&smy<10){
                guess=numbers[smy][smx].guess;
                numb=numbers[smy][smx].val;
                col=numbers[smy][smx].backg;
            }
            for(var i=0;i<9;i++){
                if(numb==(i+1)){
                  drawbox((i*pixw)+marg,(10*pixw)+marg,cageoffs,i+1,[],"#e44","#fee");
                }else{
                  drawbox((i*pixw)+marg,(10*pixw)+marg,cageoffs,i+1,[],"#ccc","#eee");
                }
                if(guess.indexOf(i+1)!=-1){
                    drawbox((i*pixw)+marg,(11*pixw)+marg,cageoffs,i+1,[],"#e44","#fed");
                }else{
                    drawbox((i*pixw)+marg,(11*pixw)+marg,cageoffs,i+1,[],"#ccc","#eee");
                }
                if(i>1){
                    if(col==pastels[i]){
                        drawbox((i*pixw)+marg,(12*pixw)+marg,cageoffs,0,[],"#fed",pastels[i]);
                    }else{
                        drawbox((i*pixw)+marg,(12*pixw)+marg,cageoffs,0,[],"#888",pastels[i]);
                    }
                }else{
                    ctx.save();
                    ctx.translate((i*pixw)+marg+cageoffs+3,(12*pixw)+marg+cageoffs+2);
                    if(i==0) floppy()
                    else folder();
                    ctx.restore();
                }
            }

						window.requestAnimationFrame(drawit);
				} 			
			
		</script>
</head>
<body onload="setup();">
 	<canvas id="myCanvas" onmousedown="mouseDown(event);" onmouseup="mouseUp(event);" onmousemove="mouseMove(event,this);" width="900" height="900" style="border:1px solid #000000;"></canvas> 
</body>
