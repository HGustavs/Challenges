<html>
    <head>
        <script src="helperFunction/seededrandom.js"></script>
        <script>
        // Conways game of life. Similar functionality to the version used in the sun xlock screen saver from 1988-91 by Patrick J. Naughton
        // https://github.com/oracle/solaris-xorg/blob/master/open-src/app/xlock/sun-src/life.c
        // https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life
        //
        // Any live cell with fewer than two live neighbours dies, as if by underpopulation.
        // Any live cell with two or three live neighbours lives on to the next generation.
        // Any live cell with more than three live neighbours dies, as if by overpopulation.

        var ctx;

        // Number of cells
        const cellwidth=150;
        const cellheight=150;
        const drawsize=4;

        // Limit function constants
        const m=0.3;
        const s=0.04;

        // Lenia strength algorithm
        const strength=0.1;

        // Gradient Lookup Table similar to Gradient from Lenia Paper
        // var gradient=["RGB(134,20,10)","RGB(136,22,10)","RGB(138,24,11)","RGB(140,27,12)","RGB(143,29,13)","RGB(145,32,14)","RGB(147,34,15)","RGB(150,36,16)","RGB(152,39,17)","RGB(154,41,17)","RGB(157,44,18)","RGB(159,46,19)","RGB(161,49,20)","RGB(164,51,21)","RGB(166,53,22)","RGB(168,56,23)","RGB(171,58,24)","RGB(173,61,25)","RGB(175,63,25)","RGB(178,65,26)","RGB(180,68,27)","RGB(182,70,28)","RGB(185,73,29)","RGB(187,75,30)","RGB(189,78,31)","RGB(192,80,32)","RGB(194,82,32)","RGB(196,85,33)","RGB(199,87,34)","RGB(201,90,35)","RGB(203,92,36)","RGB(206,94,37)","RGB(208,97,38)","RGB(210,99,39)","RGB(213,102,40)","RGB(215,104,40)","RGB(217,107,41)","RGB(220,109,42)","RGB(222,111,43)","RGB(224,114,44)","RGB(227,116,45)","RGB(229,119,46)","RGB(231,121,47)","RGB(234,124,48)","RGB(234,126,48)","RGB(234,129,49)","RGB(234,131,50)","RGB(234,134,50)","RGB(235,136,51)","RGB(235,139,52)","RGB(235,141,53)","RGB(235,144,53)","RGB(236,147,54)","RGB(236,149,55)","RGB(236,152,55)","RGB(236,154,56)","RGB(237,157,57)","RGB(237,159,58)","RGB(237,162,58)","RGB(237,164,59)","RGB(237,167,60)","RGB(238,170,60)","RGB(238,172,61)","RGB(238,175,62)","RGB(238,177,63)","RGB(239,180,63)","RGB(239,182,64)","RGB(239,185,65)","RGB(239,187,66)","RGB(240,190,66)","RGB(240,193,67)","RGB(240,195,68)","RGB(240,198,68)","RGB(240,200,69)","RGB(241,203,70)","RGB(241,205,71)","RGB(241,208,71)","RGB(241,210,72)","RGB(242,213,73)","RGB(242,216,73)","RGB(242,218,74)","RGB(242,221,75)","RGB(243,223,76)","RGB(243,226,76)","RGB(243,228,77)","RGB(243,231,78)","RGB(244,234,79)","RGB(241,233,80)","RGB(239,233,81)","RGB(236,233,83)","RGB(234,233,84)","RGB(232,233,86)","RGB(229,233,87)","RGB(227,232,89)","RGB(224,232,90)","RGB(222,232,91)","RGB(220,232,93)","RGB(217,232,94)","RGB(215,232,96)","RGB(212,231,97)","RGB(210,231,99)","RGB(208,231,100)","RGB(205,231,102)","RGB(203,231,103)","RGB(200,231,104)","RGB(198,230,106)","RGB(196,230,107)","RGB(193,230,109)","RGB(191,230,110)","RGB(188,230,112)","RGB(186,230,113)","RGB(184,229,115)","RGB(181,229,116)","RGB(179,229,117)","RGB(176,229,119)","RGB(174,229,120)","RGB(172,229,122)","RGB(169,228,123)","RGB(167,228,125)","RGB(164,228,126)","RGB(162,228,128)","RGB(160,228,129)","RGB(157,228,130)","RGB(155,227,132)","RGB(152,227,133)","RGB(150,227,135)","RGB(148,227,136)","RGB(145,227,138)","RGB(143,227,139)","RGB(141,227,141)","RGB(138,224,143)","RGB(136,221,145)","RGB(134,219,147)","RGB(132,216,150)","RGB(130,214,152)","RGB(128,211,154)","RGB(126,208,156)","RGB(124,206,159)","RGB(121,203,161)","RGB(119,201,163)","RGB(117,198,166)","RGB(115,196,168)","RGB(113,193,170)","RGB(111,190,172)","RGB(109,188,175)","RGB(107,185,177)","RGB(105,183,179)","RGB(102,180,182)","RGB(100,177,184)","RGB(98,175,186)","RGB(96,172,188)","RGB(94,170,191)","RGB(92,167,193)","RGB(90,165,195)","RGB(88,162,197)","RGB(85,159,200)","RGB(83,157,202)","RGB(81,154,204)","RGB(79,152,207)","RGB(77,149,209)","RGB(75,146,211)","RGB(73,144,213)","RGB(71,141,216)","RGB(69,139,218)","RGB(66,136,220)","RGB(64,134,223)","RGB(62,131,225)","RGB(60,128,227)","RGB(58,126,229)","RGB(56,123,232)","RGB(54,121,234)","RGB(52,118,236)","RGB(50,116,239)","RGB(48,113,236)","RGB(47,110,233)","RGB(46,108,230)","RGB(45,105,227)","RGB(44,103,225)","RGB(43,100,222)","RGB(42,98,219)","RGB(41,95,216)","RGB(40,93,214)","RGB(39,90,211)","RGB(38,88,208)","RGB(37,85,205)","RGB(36,83,203)","RGB(35,80,200)","RGB(33,77,197)","RGB(32,75,194)","RGB(31,72,191)","RGB(30,70,189)","RGB(29,67,186)","RGB(28,65,183)","RGB(27,62,180)","RGB(26,60,178)","RGB(25,57,175)","RGB(24,55,172)","RGB(23,52,169)","RGB(22,50,167)","RGB(21,47,164)","RGB(20,45,161)","RGB(18,42,158)","RGB(17,39,155)","RGB(16,37,153)","RGB(15,34,150)","RGB(14,32,147)","RGB(13,29,144)","RGB(12,27,142)","RGB(11,24,139)","RGB(10,22,136)","RGB(9,19,133)","RGB(8,17,131)","RGB(7,14,128)","RGB(6,12,125)","RGB(5,9,122)","RGB(4,7,120)","RGB(3,6,117)","RGB(3,6,114)","RGB(3,6,111)","RGB(3,6,108)","RGB(3,6,106)","RGB(3,6,103)","RGB(3,5,100)","RGB(3,5,97)","RGB(3,5,94)","RGB(3,5,92)","RGB(2,5,89)","RGB(2,5,86)","RGB(2,4,83)","RGB(2,4,80)","RGB(2,4,78)","RGB(2,4,75)","RGB(2,4,72)","RGB(2,4,69)","RGB(2,3,66)","RGB(2,3,64)","RGB(2,3,61)","RGB(1,3,58)","RGB(1,3,55)","RGB(1,3,53)","RGB(1,2,50)","RGB(1,2,47)","RGB(1,2,44)","RGB(1,2,41)","RGB(1,2,39)","RGB(1,2,36)","RGB(1,1,33)","RGB(1,1,30)","RGB(0,1,27)","RGB(0,1,25)","RGB(0,1,22)","RGB(0,1,19)","RGB(0,0,16)","RGB(0,0,13)","RGB(0,0,11)","RGB(0,0,8)"];
        var gradient=["RGB(0,0,0)","RGB(0,0,2)","RGB(0,0,5)","RGB(0,0,8)","RGB(0,0,11)","RGB(0,0,13)","RGB(0,0,16)","RGB(0,1,19)","RGB(0,1,22)","RGB(0,1,25)","RGB(0,1,27)","RGB(1,1,30)","RGB(1,1,33)","RGB(1,2,36)","RGB(1,2,39)","RGB(1,2,41)","RGB(1,2,44)","RGB(1,2,47)","RGB(1,2,50)","RGB(1,3,53)","RGB(1,3,55)","RGB(1,3,58)","RGB(2,3,61)","RGB(2,3,64)","RGB(2,3,66)","RGB(2,4,69)","RGB(2,4,72)","RGB(2,4,75)","RGB(2,4,78)","RGB(2,4,80)","RGB(2,4,83)","RGB(2,5,86)","RGB(2,5,89)","RGB(3,5,92)","RGB(3,5,94)","RGB(3,5,97)","RGB(3,5,100)","RGB(3,6,103)","RGB(3,6,106)","RGB(3,6,108)","RGB(3,6,111)","RGB(3,6,114)","RGB(3,6,117)","RGB(4,7,120)","RGB(5,9,122)","RGB(6,12,125)","RGB(7,14,128)","RGB(8,17,131)","RGB(9,19,133)","RGB(10,22,136)","RGB(11,24,139)","RGB(12,27,142)","RGB(13,29,144)","RGB(14,32,147)","RGB(15,34,150)","RGB(16,37,153)","RGB(17,39,155)","RGB(18,42,158)","RGB(20,45,161)","RGB(21,47,164)","RGB(22,50,167)","RGB(23,52,169)","RGB(24,55,172)","RGB(25,57,175)","RGB(26,60,178)","RGB(27,62,180)","RGB(28,65,183)","RGB(29,67,186)","RGB(30,70,189)","RGB(31,72,191)","RGB(32,75,194)","RGB(33,77,197)","RGB(35,80,200)","RGB(36,83,203)","RGB(37,85,205)","RGB(38,88,208)","RGB(39,90,211)","RGB(40,93,214)","RGB(41,95,216)","RGB(42,98,219)","RGB(43,100,222)","RGB(44,103,225)","RGB(45,105,227)","RGB(46,108,230)","RGB(47,110,233)","RGB(48,113,236)","RGB(50,116,239)","RGB(52,118,236)","RGB(54,121,234)","RGB(56,123,232)","RGB(58,126,229)","RGB(60,128,227)","RGB(62,131,225)","RGB(64,134,223)","RGB(66,136,220)","RGB(69,139,218)","RGB(71,141,216)","RGB(73,144,213)","RGB(75,146,211)","RGB(77,149,209)","RGB(79,152,207)","RGB(81,154,204)","RGB(83,157,202)","RGB(85,159,200)","RGB(88,162,197)","RGB(90,165,195)","RGB(92,167,193)","RGB(94,170,191)","RGB(96,172,188)","RGB(98,175,186)","RGB(100,177,184)","RGB(102,180,182)","RGB(105,183,179)","RGB(107,185,177)","RGB(109,188,175)","RGB(111,190,172)","RGB(113,193,170)","RGB(115,196,168)","RGB(117,198,166)","RGB(119,201,163)","RGB(121,203,161)","RGB(124,206,159)","RGB(126,208,156)","RGB(128,211,154)","RGB(130,214,152)","RGB(132,216,150)","RGB(134,219,147)","RGB(136,221,145)","RGB(138,224,143)","RGB(141,227,141)","RGB(143,227,139)","RGB(145,227,138)","RGB(148,227,136)","RGB(150,227,135)","RGB(152,227,133)","RGB(155,227,132)","RGB(157,228,130)","RGB(160,228,129)","RGB(162,228,128)","RGB(164,228,126)","RGB(167,228,125)","RGB(169,228,123)","RGB(172,229,122)","RGB(174,229,120)","RGB(176,229,119)","RGB(179,229,117)","RGB(181,229,116)","RGB(184,229,115)","RGB(186,230,113)","RGB(188,230,112)","RGB(191,230,110)","RGB(193,230,109)","RGB(196,230,107)","RGB(198,230,106)","RGB(200,231,104)","RGB(203,231,103)","RGB(205,231,102)","RGB(208,231,100)","RGB(210,231,99)","RGB(212,231,97)","RGB(215,232,96)","RGB(217,232,94)","RGB(220,232,93)","RGB(222,232,91)","RGB(224,232,90)","RGB(227,232,89)","RGB(229,233,87)","RGB(232,233,86)","RGB(234,233,84)","RGB(236,233,83)","RGB(239,233,81)","RGB(241,233,80)","RGB(244,234,79)","RGB(243,231,78)","RGB(243,228,77)","RGB(243,226,76)","RGB(243,223,76)","RGB(242,221,75)","RGB(242,218,74)","RGB(242,216,73)","RGB(242,213,73)","RGB(241,210,72)","RGB(241,208,71)","RGB(241,205,71)","RGB(241,203,70)","RGB(240,200,69)","RGB(240,198,68)","RGB(240,195,68)","RGB(240,193,67)","RGB(240,190,66)","RGB(239,187,66)","RGB(239,185,65)","RGB(239,182,64)","RGB(239,180,63)","RGB(238,177,63)","RGB(238,175,62)","RGB(238,172,61)","RGB(238,170,60)","RGB(237,167,60)","RGB(237,164,59)","RGB(237,162,58)","RGB(237,159,58)","RGB(237,157,57)","RGB(236,154,56)","RGB(236,152,55)","RGB(236,149,55)","RGB(236,147,54)","RGB(235,144,53)","RGB(235,141,53)","RGB(235,139,52)","RGB(235,136,51)","RGB(234,134,50)","RGB(234,131,50)","RGB(234,129,49)","RGB(234,126,48)","RGB(234,124,48)","RGB(231,121,47)","RGB(229,119,46)","RGB(227,116,45)","RGB(224,114,44)","RGB(222,111,43)","RGB(220,109,42)","RGB(217,107,41)","RGB(215,104,40)","RGB(213,102,40)","RGB(210,99,39)","RGB(208,97,38)","RGB(206,94,37)","RGB(203,92,36)","RGB(201,90,35)","RGB(199,87,34)","RGB(196,85,33)","RGB(194,82,32)","RGB(192,80,32)","RGB(189,78,31)","RGB(187,75,30)","RGB(185,73,29)","RGB(182,70,28)","RGB(180,68,27)","RGB(178,65,26)","RGB(175,63,25)","RGB(173,61,25)","RGB(171,58,24)","RGB(168,56,23)","RGB(166,53,22)","RGB(164,51,21)","RGB(161,49,20)","RGB(159,46,19)","RGB(157,44,18)","RGB(154,41,17)","RGB(152,39,17)","RGB(150,36,16)","RGB(147,34,15)","RGB(145,32,14)","RGB(143,29,13)","RGB(140,27,12)",];        // Gaussian Kernel Suggested from Lenia Paper
        var kernel=[[-3,-1,0.01],[-3,0,0.02],[-3,1,0.01],[-2,-2,0.02],[-2,-1,0.02],[-2,0,0.02],[-2,1,0.02],[-2,2,0.02],[-1,-3,0.01],[-1,-2,0.02],[-1,-1,0.09],[-1,0,0],[-1,1,0.09],[-1,2,0.02],[-1,3,0.01],[0,-3,0.02],[0,-2,0.02],[0,-1,0],[0,0,0],[0,1,0],[0,2,0.02],[0,3,0.02],[1,-3,0.01],[1,-2,0.02],[1,-1,0.09],[1,0,0],[1,1,0.09],[1,2,0.02],[1,3,0.01],[2,-2,0.02],[2,-1,0.02],[2,0,0.02],[2,1,0.02],[2,2,0.02],[3,-1,0.01],[3,0,0.02],[3,1,0.01]];

        // Limit function similar to Exponential Limit function from Lenia Paper
        function limit(u)
        {
            return 2*Math.exp(-(((u-m)*(u-m))/(2*(s*s))))-1;          
        }

        function saturate(v)
        {
          return Math.min(Math.max(v,0),1.0);         
        }

        cells=[];
        fates=[];

        // Fast Modulo function
        function mod(num,mod)
        {
            return ((num%mod)+mod)%mod;
        }

        function redraw()
        {
            // Update fates array using Kernel
            for(var xk=0;xk<cellwidth;xk++){
                for(var yk=0;yk<cellheight;yk++){
                    var sum=0;
                    for(var entry of kernel){
                        var xindex=mod(xk+entry[0],cellwidth);
                        var yindex=mod(yk+entry[1],cellheight);
                        sum+=cells[xindex+(yindex*cellwidth)]*entry[2];
                        fates[xk+(yk*cellwidth)]=limit(sum);
                    }
                }
            }

            // Update Cells using saturated moderated fates value
            for(var xk=0;xk<cellwidth;xk++){
                for(var yk=0;yk<cellheight;yk++){
                    var index=xk+(yk*cellwidth);
                    cells[index]=saturate(cells[index]+fates[index]*strength);
                }
            }

            // Draw output
            for(var xk=0;xk<cellwidth;xk++){
                for(var yk=0;yk<cellheight;yk++){
                    var r=Math.floor(cells[xk+(yk*cellwidth)]*255);
                    ctx.fillStyle=gradient[r];
                    ctx.fillRect(xk*drawsize,yk*drawsize,drawsize,drawsize);                    
                }
            }            

            window.requestAnimationFrame(redraw);
            // setTimeout(redraw,100);
        }

        function startup()
        {
            var c = document.getElementById("canvasid");
            ctx = c.getContext("2d");
            

            // Initiate Random
            var seed=77941;
            var i=0;
            for(var j=0;j<cellheight;j++){
              Math.setSeed(seed+j);
              for(var k=0;k<cellwidth;k++){
                  cells[i]=0;
                  var rnd=Math.random();
                  if(rnd>0.5) cells[i]=Math.random();
                  i++;
              } 
            }


            /*
            for(var i=0;i<150;i++){
                xk=70+Math.floor(Math.random()*10);
                yk=70+Math.floor(Math.random()*10);
                cells[xk+(yk*cellwidth)]+=0.1;
            }
            */

            redraw();
        }
        
        </script>
    </head>
    <body onload="startup();" style="background:#222;">
        <canvas id="canvasid" width=600 height=600 style="width:1200px;height:1200px;">
        </canvas>
        <!-- image-rendering:pixelated;  -->
    </body>
</html>